<div *appHasNoRole="['Pishkhan']">
  <button *ngIf="rData.hasDefineObserveState" nbTooltip="چاپ نقشه" nbTooltipPlacement="top" size="tiny"
    class="mb-2 mr-1" nbButton status="secondary" (click)="onPipingMapPrint(rData.requestUnitId)">
    <nb-icon [options]="{ animation: { type: 'zoom' } }" class="icon-button" icon="printer-outline">
    </nb-icon>
  </button>

  <button nbTooltip="حذف" nbTooltipPlacement="top" size="tiny" *appHasRole="['Admin']" class="mb-2 mr-1" nbButton
    [disabled]="!rData.nextStateType.includes('ControlDocuments')" status="danger" (click)="onDelete(rData)">
    <nb-icon [options]="{ animation: { type: 'zoom' } }" class="icon-button" icon="close-outline">
    </nb-icon>
  </button>

  <button nbTooltip="ویرایش" nbTooltipPlacement="top" size="tiny" class="mb-2 mr-1" nbButton
    [disabled]="!rData.nextStateType.includes('ControlDocuments') || rData.nextStateType.includes('RequestInspectionPreExecution')"
    status="warning" (click)="onEdit(rData.requestUnitId)">
    <nb-icon [options]="{ animation: { type: 'zoom' } }" class="icon-button" icon="edit-2-outline">
    </nb-icon>
  </button>

  <button nbTooltip="مشاهده جزئیات" nbTooltipPlacement="top" size="tiny" class="mb-2 mr-1" nbButton status="info"
    (click)="onShowDetail()">
    <nb-icon [options]="{ animation: { type: 'zoom' } }" class="alert-circle-outline" icon="eye-outline">
    </nb-icon>
  </button>

  <nb-select placeholder="انتخاب عملیات" status="success">
    <nb-option value="0">
      <button fullWidth nbButton status="primary" (click)="onHistory(rData.requestUnitId)">
        مشاهده سوابق واحد
      </button>
    </nb-option>

    <nb-option>
      <button fullWidth status="primary" nbButton (click)="onPipeLineMap(rData.requestUnitId)">
        مشاهده نقشه لوله کشی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ControlDocuments')">
      <button *appHasRole="['Admin', 'GasEmployee', 'GasEmployeeExceptShiraz','AnalyzeEmployee']" fullWidth status="success" nbButton
        (click)="onControlDocuments(rData.requestUnitId, 'ControlDocuments')">
        کنترل مدارک
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ReInsertRecordMapInformation')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth status="success" nbButton (click)="
          onReInsertRecordMapInformation(
            rData.requestUnitId,
            'ReInsertRecordMapInformation'
          )
        ">
        ویرایش اطلاعات توسط مجری
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('RequestInspectionPreExecution')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth status="primary" nbButton (click)="
          onRequestInspection(
            rData.requestUnitId,
            'RequestInspectionPreExecution'
          )
        ">
        درخواست بازرسی پیش از اجرا
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('RequestReInspectionPreExecution')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth status="primary" nbButton (click)="
          onRequestInspection(
            rData.requestUnitId,
            'RequestReInspectionPreExecution'
          )
        ">
        درخواست بازرسی مجدد پیش از اجرا
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('PayRequestInspectionPreExecution')">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayRequestInspectionPreExecution'
          )
        ">
        پرداخت بازرسی پیش از اجرا
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('PayRequestReInspectionPreExecution')">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayRequestReInspectionPreExecution'
          )
        ">
        پرداخت بازرسی مجدد پیش از اجرا
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('SafetyInspectionRequest')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onSafetyInspectionRequest(
            rData.requestUnitId,
            'SafetyInspectionRequest'
          )
        ">
        درخواست بازرسی ایمنی
      </button>
    </nb-option>
    <nb-option *ngIf="rData.nextStateType.includes('PaySafetyInspectionRequest')">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PaySafetyInspectionRequest'
          )
        ">
        پرداخت بازرسی ایمنی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('RequestInspectionWelding')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspection(rData.requestUnitId, 'RequestInspectionWelding')
        ">
        درخواست بازرسی جوش خطی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('PayRequestInspectionWelding')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayRequestInspectionWelding'
          )
        ">
        پرداخت بازرسی جوش خطی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.hasPayDiffrenceLinearInspectionWelding">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayDiffrenceLinearInspectionWelding'
          )
        ">
        پرداخت ما به التفاوت بازرسی جوش خطی
      </button>
    </nb-option>


    <nb-option *ngIf="rData.hasPayDiffrenceCollectorInspectionWelding">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
        onPayRequestInspection(
          rData.requestUnitId,
          'PayDiffrenceCollectorInspectionWelding'
        )
      ">
        پرداخت ما به التفاوت بازرسی جوش کلکتوری
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes('MapRevisionResultInspectionPreExecution')
      ">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="default" (click)="
          onReInsertRecordMapInformation(
            rData.requestUnitId,
            'MapRevisionResultInspectionPreExecution'
          )
        ">
        اصلاحیه نقشه
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ChangeResultInspectionPreExecution')">
      <button *appHasRole="['Admin', 'Engineer']" fullWidth nbButton status="primary" (click)="
        onResultInspection(
          rData.requestUnitId,
          'ChangeResultInspectionPreExecution'
        )
      ">
        تغییر نتیجه بازرسی پیش از اجرا
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes('RequestMapRevisionInspectionPreExecution')
      ">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspection(
            rData.requestUnitId,
            'RequestMapRevisionInspectionPreExecution'
          )
        ">
        درخواست اصلاحیه نقشه بازرسی پیش از اجرا
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ControlDocumentsInspectionPreExecution')">
      <button *appHasRole="['Admin', 'Engineer']" fullWidth status="success" nbButton (click)="
        onControlDocuments(
          rData.requestUnitId,
          'ControlDocumentsInspectionPreExecution'
        )
      ">
        کنترل نقشه بازرسی پیش از اجرا
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes(
          'ReMapRevisionResultInspectionPreExecution'
        )
      ">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="default" (click)="
        onReInsertRecordMapInformation(
            rData.requestUnitId,
            'ReMapRevisionResultInspectionPreExecution'
          )
        ">
        اصلاحیه نقشه
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('RequestInspectionOfTheFirstStage')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspectionOfTheFirstStage(
            rData.requestUnitId,
            'RequestInspectionOfTheFirstStage'
          )
        ">
        درخواست بازرسی مرحله اول
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes('PayRequestInspectionOfTheFirstStage')
      ">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayRequestInspectionOfTheFirstStage'
          )
        ">
        پرداخت بازرسی مرحله اول
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes('PayReRequestInspectionOfTheFirstStage')
      ">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayReRequestInspectionOfTheFirstStage'
          )
        ">
        پرداخت بازرسی مجدد مرحله اول
      </button>
    </nb-option>
    <nb-option *ngIf="rData.nextStateType.includes('RequestInspectionFinal')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspection(rData.requestUnitId, 'RequestInspectionFinal')
        ">
        درخواست بازرسی نهایی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('RequestReInspectionFinal')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspection(rData.requestUnitId, 'RequestReInspectionFinal')
        ">
        درخواست بازرسی مجدد نهایی
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes(
          'RequestMapRevisionInspectionOfTheFirstStage'
        )
      ">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspection(
            rData.requestUnitId,
            'RequestMapRevisionInspectionOfTheFirstStage'
          )
        ">
        درخواست اصلاحیه نقشه بازرسی مرحله اول
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('RequestMapRevisionInspectionFinal')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspection(
            rData.requestUnitId,
            'RequestMapRevisionInspectionFinal'
          )
        ">
        درخواست نوبت اصلاحیه نقشه بازرسی نهایی
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes(
          'MapRevisionResultInspectionOfTheFirstStage'
        )
      ">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="default" (click)="
          onReInsertRecordMapInformationOfTheFirstStage(
            rData.requestUnitId,
            'MapRevisionResultInspectionOfTheFirstStage'
          )
        ">
        اصلاحیه نقشه
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes(
          'PayMapRevisionResultInspectionOfTheFirstStage'
        )
      ">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayMapRevisionResultInspectionOfTheFirstStage'
          )
        ">
        پرداخت اصلاح نقشه بازرسی مرحله اول
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes(
          'ControlDocumentsInspectionOfTheFirstStage'
        )
      ">
      <button *appHasRole="['Admin', 'Engineer']" fullWidth status="success" nbButton (click)="
          onControlDocumentsInspectionOfTheFirstStage(
            rData.requestUnitId,
            'ControlDocumentsInspectionOfTheFirstStage'
          )
        ">
        کنترل نقشه بازرسی مرحله اول
      </button>
    </nb-option>
    <nb-option *ngIf="
        rData.nextStateType.includes('ReMapRevisionResultInspectionOfTheFirstStage')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="default" (click)="
          onReInsertRecordMapInformationOfTheFirstStage(
            rData.requestUnitId,
            'ReMapRevisionResultInspectionOfTheFirstStage'
          )
        ">
        اصلاحیه نقشه
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ReRequestInspectionOfTheFirstStage')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onRequestInspectionOfTheFirstStage(
            rData.requestUnitId,
            'ReRequestInspectionOfTheFirstStage'
          )
        ">
        درخواست بازرسی مجدد مرحله اول
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('PayRequestInspectionFinal')">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="warning" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayRequestInspectionFinal'
          )
        ">
        پرداخت بازرسی نهایی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('PayRequestReInspectionFinal')">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="warning" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayRequestReInspectionFinal'
          )
        ">
        پرداخت بازرسی مجدد نهایی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('MapRevisionResultInspectionFinal')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="default" (click)="
          onReInsertRecordMapInformation(
            rData.requestUnitId,
            'MapRevisionResultInspectionFinal'
          )
        ">
        اصلاحیه نقشه
      </button>
    </nb-option>

    <nb-option *ngIf="
        rData.nextStateType.includes('PayMapRevisionResultInspectionFinal')
      ">
      <button *appHasRole="['Admin', 'Executor', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        status="warning" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayMapRevisionResultInspectionFinal'
          )
        ">
        پرداخت اصلاحیه نقشه بازرسی نهایی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ControlDocumentsInspectionFinal')">
      <button *appHasRole="['Admin', 'Engineer']" fullWidth status="success" nbButton (click)="
          onControlDocuments(
            rData.requestUnitId,
            'ControlDocumentsInspectionFinal'
          )
        ">
        کنترل نقشه بازرسی نهایی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ReMapRevisionResultInspectionFinal')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="default" (click)="
          onReInsertRecordMapInformation(
            rData.requestUnitId,
            'ReMapRevisionResultInspectionFinal'
          )
        ">
        اصلاحیه نقشه
      </button>
    </nb-option>


    <nb-option *ngIf="rData.nextStateType.includes('ReRegisterUnitMapChanges')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="warning" (click)="
          onReInsertRecordMapInformation(
            rData.requestUnitId,
            'ReRegisterUnitMapChanges'
          )
        ">
        درخواست مجدد بازرسی به دلیل تغییرات لوله کشی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('WorkFlowForm')">
      <button *appHasRole="['Admin', 'Pishkhan', 'GasEmployee','AnalyzeEmployee', 'GasEmployeeExceptShiraz']" fullWidth nbButton
        (click)="onUnitWorkFlow(rData.requestUnitId)" status="warning">
        فرم گردان شرکت گاز
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('RequestInspectionCollectorWelding')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
        onRequestInspection(rData.requestUnitId, 'RequestInspectionCollectorWelding')
      ">
        درخواست بازرسی جوش کلکتوری
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('PayRequestInspectionCollectorWelding')">
      <button *appHasRole="['Admin', 'Executor']" fullWidth nbButton status="primary" (click)="
          onPayRequestInspection(
            rData.requestUnitId,
            'PayRequestInspectionCollectorWelding'
          )
        ">
        پرداخت بازرسی جوش کلکتوری
      </button>
    </nb-option>

    <nb-option *ngIf="rData?.nextStateType?.includes('ControlFinal')">
      <button fullWidth status="success" *appHasRole="['Admin','GasEmployee','AnalyzeEmployee','GasEmployeeExceptShiraz']" nbButton
        (click)="OnControlFinal(rData.requestUnitId)">
        کنترل نهایی
      </button>
    </nb-option>
    <nb-option *ngIf="rData?.nextStateType?.includes('CompleteControlFinal')">
      <button fullWidth status="success" *appHasRole="['Admin','Executor']" nbButton
        (click)="OnCompleteControlFinal(rData.requestUnitId)">
        تکمیل مستندات نهایی
      </button>
    </nb-option>
    <nb-option *ngIf="rData?.nextStateType?.includes('PayDiffrenceInspection')">
      <button fullWidth status="success" *appHasRole="['Admin','Executor']" nbButton 
      (click)="onPayRequestInspection(
          rData.requestUnitId,
          'PayDiffrenceInspection'
        )">
        پرداخت ما به التفاوت بازرسی
      </button>
    </nb-option>

    <nb-option *ngIf="rData.nextStateType.includes('ControlDocumentsInspectionSixMonth')">
      <button *appHasRole="['Admin', 'Engineer']" fullWidth status="success" nbButton (click)="
          onControlDocuments(
            rData.requestUnitId,
            'ControlDocumentsInspectionSixMonth'
          )
        ">
        کنترل نقشه بازرسی شش ماه گذشته  
      </button>
    </nb-option>

    <nb-option *ngIf="rData.lastRequestStateTypeClassName === 'ControlDocumentsInspectionPreExecution'
    || rData.lastRequestStateTypeClassName === 'ControlDocumentsInspectionOfTheFirstStage'
    || rData.lastRequestStateTypeClassName === 'ControlDocumentsInspectionFinal'
    || rData.lastRequestStateTypeClassName === 'ControlDocumentsInspectionSixMonth'
    ">
      <button *appHasRole="['Admin', 'Engineer']" fullWidth status="warning" nbButton (click)="
      onEditControlDocuments(
            rData.requestUnitId,
            'ControlDocumentsInspectionSixMonth'
          )
        ">
        ویرایش کنترل نقشه  
      </button>
    </nb-option>
    
    <nb-option *ngIf="!rData?.endOrBlockRequestId">
      <button fullWidth nbButton status="danger" *appHasRole="['Admin', 'GasEmployee','AnalyzeEmployee']"
        (click)="onEndOrBlockRequest(rData)">
        غیر فعال سازی
      </button>
    </nb-option>
    <nb-option *ngIf="rData?.endOrBlockRequestId">
      <button fullWidth nbButton status="success" *appHasRole="['Admin', 'GasEmployee','AnalyzeEmployee']"
        (click)="onStopEndOrBlockRequest()">
        فعال سازی
      </button>
    </nb-option>
  </nb-select>
</div>

<nb-select placeholder="انتخاب عملیات" *appHasRole="['Pishkhan']">
  <nb-option *ngIf="rData.nextStateType.includes('WorkFlowForm')">
    <button fullWidth nbButton (click)="onUnitWorkFlow(rData.requestUnitId)" status="warning">
      فرم گردان شرکت گاز
    </button>
  </nb-option>
</nb-select>

<ng-template #contentRecordMapInformationDetailTemplate let-data>
  <app-recordMapInformationDetail [requestUnitId]="rData.requestUnitId" [rowContractId]="rData.contractId">
  </app-recordMapInformationDetail>
</ng-template>

<ng-template #RecordMapInformationHistoryEditMap let-data>
  <app-RecordMapInformationHistoryEditMapComponent [requestUnitId]="rData.requestUnitId" [rowContractId]="rData.contractId">
  </app-RecordMapInformationHistoryEditMapComponent>
</ng-template>

<ng-template #pipeLineMap let-data>
  <ngx-pipeLineMap [requestUnitId]="rData.requestUnitId" [rowContractId]="rData.contractId"></ngx-pipeLineMap>
</ng-template>