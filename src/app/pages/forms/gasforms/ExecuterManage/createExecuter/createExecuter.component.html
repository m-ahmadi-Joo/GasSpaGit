<nb-card>
  <nb-card-header> افزودن مجری </nb-card-header>
  <nb-card-body>
    <form (ngSubmit)="onSubmit()" [formGroup]="sendForm">
      <nb-card>
        <nb-card-body>
          <div class="row">
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label> کد ملی:</label>
              <input
                formControlName="nationalID"
                fullWidth
                nbInput
                (blur)="nationalIDIsExist()"
              />
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.nationalID"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('nationalID').hasError(validation.type) &&
                    (sendForm.get('nationalID').dirty ||
                      sendForm.get('nationalID').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>نام:</label>
              <input formControlName="firstName" fullWidth nbInput />
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.firstName"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('firstName').hasError(validation.type) &&
                    (sendForm.get('firstName').dirty ||
                      sendForm.get('firstName').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label> نام خانوادگی:</label>
              <input formControlName="lastName" fullWidth nbInput />
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.lastName"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('lastName').hasError(validation.type) &&
                    (sendForm.get('lastName').dirty ||
                      sendForm.get('lastName').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>

            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>شماره موبایل</label>
              <input formControlName="phoneNumber" fullWidth nbInput />
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.phoneNumber"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('phoneNumber').hasError(validation.type) &&
                    (sendForm.get('phoneNumber').dirty ||
                      sendForm.get('phoneNumber').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
          </div>
        </nb-card-body>
      </nb-card>
      <nb-card>
        <nb-card-body>
          <div class="row">
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>کد مجری:</label>
              <input formControlName="executerCode" placeholder="****-*" fullWidth nbInput />
              <div
                *ngFor="
                  let validation of INPUT_VALIDATION_MESSAGES.executerCode
                "
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('executerCode').hasError(validation.type) &&
                    (sendForm.get('executerCode').dirty ||
                      sendForm.get('executerCode').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>نام پدر:</label>
              <input formControlName="fatherName" fullWidth nbInput />
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.fatherName"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('fatherName').hasError(validation.type) &&
                    (sendForm.get('fatherName').dirty ||
                      sendForm.get('fatherName').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>شماره شناسنامه:</label>
              <input
                formControlName="birthCertificateNumber"
                fullWidth
                nbInput
              />
              <div
                *ngFor="
                  let validation of INPUT_VALIDATION_MESSAGES.birthCertificateNumber
                "
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm
                      .get('birthCertificateNumber')
                      .hasError(validation.type) &&
                    (sendForm.get('birthCertificateNumber').dirty ||
                      sendForm.get('birthCertificateNumber').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>محل تولد:</label>
              <input formControlName="placeOfIssue" fullWidth nbInput />
              <div
                *ngFor="
                  let validation of INPUT_VALIDATION_MESSAGES.placeOfIssue
                "
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('placeOfIssue').hasError(validation.type) &&
                    (sendForm.get('placeOfIssue').dirty ||
                      sendForm.get('placeOfIssue').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
          </div>
        </nb-card-body>
      </nb-card>
      <nb-card>
        <nb-card-body>
          <div class="row mt-4">
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>شماره مهر:</label>
              <input readonly="readonly" formControlName="stampNumber" fullWidth nbInput />
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.stampNumber"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('stampNumber').hasError(validation.type) &&
                    (sendForm.get('stampNumber').dirty ||
                      sendForm.get('stampNumber').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>نام دفتر:</label>
              <input formControlName="officeName" fullWidth nbInput />
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.officeName"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('officeName').hasError(validation.type) &&
                    (sendForm.get('officeName').dirty ||
                      sendForm.get('officeName').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>مدرک تحصیلی:</label>
              <input formControlName="degree" fullWidth nbInput />
              <div *ngFor="let validation of INPUT_VALIDATION_MESSAGES.degree">
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('degree').hasError(validation.type) &&
                    (sendForm.get('degree').dirty ||
                      sendForm.get('degree').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>شماره گواهینامه:</label>
              <input formControlName="diplomaNumber" fullWidth nbInput />
              <div
                *ngFor="
                  let validation of INPUT_VALIDATION_MESSAGES.diplomaNumber
                "
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('diplomaNumber').hasError(validation.type) &&
                    (sendForm.get('diplomaNumber').dirty ||
                      sendForm.get('diplomaNumber').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
          </div>
        </nb-card-body>
      </nb-card>
      <div class="row mr-2 mt-5">
        <div class="col-sm-4 col-md-4 col-lg-4">
          <label>تاریخ شروع به کار:</label>
          <dp-date-picker
            name="cd"
            fullWidth
            id="cd"
            nbInput
            dir="rtl"
            mode="day"
            theme="dp-material"
            formControlName="startDate"
            class="col-sm-9"
          ></dp-date-picker>
          <div *ngFor="let validation of INPUT_VALIDATION_MESSAGES.startDate">
            <span
              class="text-danger"
              *ngIf="
                sendForm.get('startDate').hasError(validation.type) &&
                (sendForm.get('startDate').dirty ||
                  sendForm.get('startDate').touched)
              "
              >{{ validation.message }}</span
            >
          </div>
        </div>
        <div class="col-sm-4 col-md-4 col-lg-4">
          <label>تاریخ دریافت مهر:</label>
          <dp-date-picker
            name="cd"
            fullWidth
            id="cd"
            nbInput
            dir="rtl"
            mode="day"
            theme="dp-material"
            formControlName="dateReceivedStamp"
            class="col-sm-9"
          ></dp-date-picker>
          <div
            *ngFor="
              let validation of INPUT_VALIDATION_MESSAGES.dateReceivedStamp
            "
          >
            <span
              class="text-danger"
              *ngIf="
                sendForm.get('dateReceivedStamp').hasError(validation.type) &&
                (sendForm.get('dateReceivedStamp').dirty ||
                  sendForm.get('dateReceivedStamp').touched)
              "
              >{{ validation.message }}</span
            >
          </div>
        </div>
        <div class="col-sm-4 col-md-4 col-lg-4">
          <label>تاریخ شروع پروانه:</label>
          <dp-date-picker
            name="cd"
            fullWidth
            id="cd"
            nbInput
            dir="rtl"
            mode="day"
            theme="dp-material"
            formControlName="licenseStartDate"
            class="col-sm-9"
          ></dp-date-picker>
          <div
            *ngFor="
              let validation of INPUT_VALIDATION_MESSAGES.licenseStartDate
            "
          >
            <span
              class="text-danger"
              *ngIf="
                sendForm.get('licenseStartDate').hasError(validation.type) &&
                (sendForm.get('licenseStartDate').dirty ||
                  sendForm.get('licenseStartDate').touched)
              "
              >{{ validation.message }}</span
            >
          </div>
        </div>
      </div>
      <div class="row mr-2 mt-5 mb-3">
        <div class="col-sm-4 col-md-4 col-lg-4">
          <label>تاریخ انقضاء پروانه:</label>
          <dp-date-picker
            name="cd"
            fullWidth
            id="cd"
            nbInput
            dir="rtl"
            mode="day"
            theme="dp-material"
            formControlName="licenseExpireDate"
            class="col-sm-9"
          ></dp-date-picker>

          <div
            *ngFor="
              let validation of INPUT_VALIDATION_MESSAGES.licenseExpireDate
            "
          >
            <span
              class="text-danger"
              *ngIf="
                sendForm.get('licenseExpireDate').hasError(validation.type) &&
                (sendForm.get('licenseExpireDate').dirty ||
                  sendForm.get('licenseExpireDate').touched)
              "
              >{{ validation.message }}</span
            >
          </div>
        </div>
        <div class="col-sm-4 col-md-4 col-lg-4">
          <label>تاریخ گواهینامه:</label>
          <dp-date-picker
            name="cd"
            fullWidth
            id="cd"
            nbInput
            dir="rtl"
            mode="day"
            theme="dp-material"
            formControlName="diplomaDate"
            class="col-sm-9"
          ></dp-date-picker>

          <div *ngFor="let validation of INPUT_VALIDATION_MESSAGES.diplomaDate">
            <span
              class="text-danger"
              *ngIf="
                sendForm.get('diplomaDate').hasError(validation.type) &&
                (sendForm.get('diplomaDate').dirty ||
                  sendForm.get('diplomaDate').touched)
              "
              >{{ validation.message }}</span
            >
          </div>
        </div>
        <div class="col-sm-3 col-md-3 col-lg-3">
          <label>صلاحیت طراحی دارد؟</label>
          <nb-radio-group
            class="form-inline radio-x-inline"
            formControlName="isDesigncompetence"
            id="isDesigncompetence"
            name="isDesigncompetence"
          >
            <nb-radio value="1"> بلی </nb-radio>
            <nb-radio value="0"> خیر </nb-radio>
          </nb-radio-group>
          <div
            *ngFor="
              let validation of INPUT_VALIDATION_MESSAGES.isDesigncompetence
            "
          >
            <span
              class="text-danger"
              *ngIf="
                sendForm.get('isDesigncompetence').hasError(validation.type) &&
                (sendForm.get('isDesigncompetence').dirty ||
                  sendForm.get('isDesigncompetence').touched)
              "
              >{{ validation.message }}</span
            >
          </div>
        </div>
      </div>

      <nb-card>
        <nb-card-body>
          <div class="row">
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>اجازه کار در فشار قوی دارد؟</label>
              <nb-radio-group
                class="form-inline radio-x-inline"
                formControlName="highGasPressureAllow"
                id="highGasPressureAllow"
                name="highGasPressureAllow"
              >
                <nb-radio value="1"> بلی </nb-radio>
                <nb-radio value="0"> خیر </nb-radio>
              </nb-radio-group>
              <div
                *ngFor="
                  let validation of INPUT_VALIDATION_MESSAGES.highGasPressureAllow
                "
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm
                      .get('highGasPressureAllow')
                      .hasError(validation.type) &&
                    (sendForm.get('highGasPressureAllow').dirty ||
                      sendForm.get('highGasPressureAllow').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-5 col-md-5 col-lg-5">
              <label>نوع فعالیت:</label>
              <nb-radio-group
                class="form-inline radio-x-inline"
                formControlName="executerType"
                id="executerType"
                name="executerType"
              >
                <nb-radio value="1"> شخص حقوقی </nb-radio>
                <nb-radio value="0"> شخص حقیقی </nb-radio>
                <nb-radio value="2"> تجربی </nb-radio>
              </nb-radio-group>
              <div
                *ngFor="
                  let validation of INPUT_VALIDATION_MESSAGES.executerType
                "
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('executerType').hasError(validation.type) &&
                    (sendForm.get('executerType').dirty ||
                      sendForm.get('executerType').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-4 col-md-4 col-lg-4">
              <label>مبحث 17:</label>
              <nb-radio-group
                class="form-inline radio-x-inline"
                formControlName="isTopic17"
                id="isTopic17"
                name="isTopic17"
              >
                <nb-radio value="0"> ندارد </nb-radio>
                <nb-radio value="1"> دارد </nb-radio>
              </nb-radio-group>
              <div
                *ngFor="let validation of INPUT_VALIDATION_MESSAGES.isTopic17"
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('isTopic17').hasError(validation.type) &&
                    (sendForm.get('isTopic17').dirty ||
                      sendForm.get('isTopic17').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
          </div>
        </nb-card-body>
      </nb-card>

      <nb-card>
        <nb-card-body>
          <div class="row">
            <div class="col-sm-4 col-md-4 col-lg-4">
              <label>پایه:</label>
              <nb-radio-group
                class="form-inline radio-x-inline"
                formControlName="executerGrade"
                id="executerGrade"
                name="executerGrade"
              >
                <nb-radio [value]="'Grade1'"> پایه 1 </nb-radio>
                <nb-radio [value]="'Grade2'"> پایه 2 </nb-radio>
                <nb-radio [value]="'Grade3'"> پایه 3 </nb-radio>
              </nb-radio-group>
              <div
                *ngFor="
                  let validation of INPUT_VALIDATION_MESSAGES.executerGrade
                "
              >
                <span
                  class="text-danger"
                  *ngIf="
                    sendForm.get('executerGrade').hasError(validation.type) &&
                    (sendForm.get('executerGrade').dirty ||
                      sendForm.get('executerGrade').touched)
                  "
                  >{{ validation.message }}</span
                >
              </div>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
              <label>وضعیت:</label>
              <nb-radio-group
                class="form-inline radio-x-inline"
                formControlName="isDeleted"
                id="isDeleted"
                name="isDeleted"
              >
                <nb-radio value="0"> فعال </nb-radio>
                <nb-radio value="1"> غیر فعال </nb-radio>
              </nb-radio-group>
            </div>
            <div class="col-sm-4 col-md-4 col-lg-4">
              <label>شهر محل کار:</label>
              <nb-select
                style="width: 80%"
                #areasSelect
                multiple
                placeholder="انتخاب شهر"
                id="neighborhood"
                formControlName="workTown"
              >
                <nb-option *ngFor="let town of towns" [value]="town.townId">
                  {{ town.townName }}
                </nb-option>
              </nb-select>
            </div>
          </div>
        </nb-card-body>
      </nb-card>
      <div class="row">
        <div class="col-sm-4">
          <label>انتخاب پروژه میهمان:</label>
          <input
            formControlName="gasRequestSelect"
            [typeahead]="gasStates"
            typeaheadOptionField="searchItem"
            (typeaheadOnSelect)="onSelect($event)"
            [typeaheadOptionsLimit]="7"
            [typeaheadMinLength]="0"
            class="form-control"
            style="width: 98%"
          />
        </div>
        <div
          class="col-md-5"
          style="padding-left: 7px; padding-right: 28px"
          *ngIf="
            sendForm.get('gasRequestSelect').value !== '' &&
            sendForm.get('gasRequestSelect').value !== null
          "
        >
          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>شماره درخواست</th>
                  <th>آدرس</th>
                  <th>تعداد واحد</th>
                  <th>تعداد طبقه</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ selectedOption?.fileNumber }}</td>
                  <td>{{ selectedOption?.address.substring(0, 7) }} ...</td>
                  <td>{{ selectedOption?.unitCount }}</td>
                  <td>{{ selectedOption?.floorCount }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div
          class="col-sm-3 mt-4"
          *ngIf="
            sendForm.get('gasRequestSelect').value !== '' &&
            sendForm.get('gasRequestSelect').value !== null
          "
        >
          <button
            class="btn"
            nbButton
            status="success"
            style="width: 100%"
            type="button"
            (click)="onAddToGuestProject()"
          >
            افزودن
          </button>
        </div>
      </div>
      <div class="row mt-5" *ngIf="requests !== null && requests.length > 0">
        <div>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>شماره درخواست</th>
                <th>آدرس</th>
                <th>تعداد واحد</th>
                <th>تعداد طبقه</th>
                <th>زیر بنا</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let a of requests">
                <td>{{ a?.fileNumber }}</td>
                <td>{{ a?.address.substring(0, 17) }} ...</td>
                <td>{{ a?.unitCount }}</td>
                <td>{{ a?.floorCount }}</td>
                <td>{{ a?.totalFoundation }}</td>
                <td>
                  <button
                    type="button"
                    (click)="removeInputFields(a)"
                    nbButton
                    status="danger"
                    size="tiny"
                    class="btn h-75"
                  >
                    <nb-icon
                      [options]="{ animation: { type: 'pulse' } }"
                      class="icon-button"
                      icon="close"
                    >
                    </nb-icon>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <nb-card>
        <nb-card-body>
          <label>توضیحات:</label>
          <textarea
            name="cmt"
            id="cmt"
            rows="5"
            nbInput
            fullWidth
            formControlName="desc"
          ></textarea>
        </nb-card-body>
      </nb-card>
      <!-- <nb-card>


        <nb-card-body>
          <button
            class="btn"
            nbButton
            status="success"
            style="width: 100%;"
            type="submit"
            *ngIf="!isEdit"
            [disabled]="sendForm.invalid"
          >
            ثبت
          </button>
          <button
          class="btn"
          nbButton
          status="primary"
          style="width: 100%;"
          type="submit"
          *ngIf="isEdit"
          [disabled]="sendForm.invalid"
        >
          ویرایش
        </button>
        </nb-card-body>
      </nb-card> -->

      <nb-card>
        <nb-card-body>
          <div class="row" style="text-align: left; direction: ltr">
            <div class="col-sm-2 col-md-2 col-lg-2 p-1">
              <button
                class="btn"
                nbButton
                status="warning"
                style="width: 100%"
                type="button"
                [routerLink]="['/pages/forms/ExecutersList']"
              >
                بازگشت به لیست
              </button>
            </div>
            <div class="col-sm-2 col-md-2 col-lg-2 p-1" *ngIf="!isEdit">
              <button
                class="btn"
                nbButton
                [nbSpinner]="loading"
                nbSpinnerStatus="info"
                nbSpinnerSize="large"
                status="success"
                style="width: 100%"
                type="submit"
                *ngIf="!isEdit"
                [disabled]="sendForm.invalid || loading"
              >
                ثبت
              </button>
            </div>
            <div class="col-sm-2 col-md-2 col-lg-2 p-1" *ngIf="isEdit">
              <button
                class="btn"
                nbButton
                status="success"
                style="width: 100%"
                type="submit"
                *ngIf="isEdit"
                [disabled]="sendForm.invalid"
              >
                ویرایش
              </button>
            </div>
            <div class="col-sm-2 col-md-2 col-lg-2 p-1" *ngIf="!isEdit">
              <button
                class="btn"
                nbButton
                status="primary"
                style="width: 100%"
                type="button"
                *appHasRole="['Admin', 'GasEmployee']"
                (click)="sendForm.reset()"
              >
                جدید
              </button>
            </div>
            <div class="col-sm-2 col-md-2 col-lg-2 p-1" *ngIf="isEdit">
              <button
                class="btn"
                nbButton
                status="primary"
                style="width: 100%"
                type="button"
                *appHasRole="['Admin', 'GasEmployee', 'Association']"
                [routerLink]="['/pages/forms/CreateExecuter']"
              >
                جدید
              </button>
            </div>
          </div>
        </nb-card-body>
      </nb-card>
    </form>
  </nb-card-body>
</nb-card>
